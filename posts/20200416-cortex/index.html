<!DOCTYPE html>
<html><head>
<title>æœºå™¨å­¦ä¹ åœ¨çº¿æ¨ç†éƒ¨ç½²æ–¹æ¡ˆï¼šCortex</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-162706610-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="stylesheet" href="https://xujiahua.github.io/scss/journal.min.5c667e74038e21ddbb9024b67930f8544e02af62491281cf73fdb817eec2947e.css" integrity="sha256-XGZ&#43;dAOOId27kCS2eTD4VE4Cr2JJEoHPc/24F&#43;7ClH4=" media="screen">

<script src="https://xujiahua.github.io//js/loadCSS.js"></script>
<script src="https://xujiahua.github.io//js/table.js"></script>


<script src="https://xujiahua.github.io//js/toc.js"></script>


<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>






</head><body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://xujiahua.github.io/">
    
        <div class="nav-title">
            è®¸å˜‰åçš„ç¬”è®°
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2020 è®¸å˜‰åçš„ç¬”è®°
	
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#cortex-%e4%bb%8b%e7%bb%8d" v-on:click="closeDrawer" id="cortex-ä»‹ç»-nav">
										 Cortex ä»‹ç»
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#key-features" v-on:click="closeDrawer" id="key-features-nav">
										 Key Features
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%88%91%e7%9a%84%e4%bd%93%e9%aa%8c" v-on:click="closeDrawer" id="æˆ‘çš„ä½“éªŒ-nav">
										 æˆ‘çš„ä½“éªŒ
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84" v-on:click="closeDrawer" id="ä»£ç ç»“æ„-nav">
										 ä»£ç ç»“æ„
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#cortex-%e9%95%9c%e5%83%8f%e4%bd%93%e9%aa%8c" v-on:click="closeDrawer" id="cortex-é•œåƒä½“éªŒ-nav">
										 cortex é•œåƒä½“éªŒ
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#cortex-%e4%bb%8b%e7%bb%8d" v-on:click="closeDrawer" id="cortex-ä»‹ç»-nav">
										 Cortex ä»‹ç»
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#key-features" v-on:click="closeDrawer" id="key-features-nav">
										 Key Features
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e6%88%91%e7%9a%84%e4%bd%93%e9%aa%8c" v-on:click="closeDrawer" id="æˆ‘çš„ä½“éªŒ-nav">
										 æˆ‘çš„ä½“éªŒ
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84" v-on:click="closeDrawer" id="ä»£ç ç»“æ„-nav">
										 ä»£ç ç»“æ„
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#cortex-%e9%95%9c%e5%83%8f%e4%bd%93%e9%aa%8c" v-on:click="closeDrawer" id="cortex-é•œåƒä½“éªŒ-nav">
										 cortex é•œåƒä½“éªŒ
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://xujiahua.github.io/">
            è®¸å˜‰åçš„ç¬”è®°
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://xujiahua.github.io/">
        <div class="single-column-header-title">è®¸å˜‰åçš„ç¬”è®°</div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                 style="background-image: url('/')">
                <div class="post-title">
                    æœºå™¨å­¦ä¹ åœ¨çº¿æ¨ç†éƒ¨ç½²æ–¹æ¡ˆï¼šCortex
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2020-04-16 11:33
                        </time>
                        

                        

                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                <div class="post-body">
                    <h2 id="cortex-ä»‹ç»">Cortex ä»‹ç»</h2>
<p>å®˜æ–¹ç½‘ç«™ï¼šDeploy machine learning models in production <a href="https://www.cortex.dev/">https://www.cortex.dev/</a></p>
<p>GitHub <a href="https://github.com/cortexlabs/cortex">https://github.com/cortexlabs/cortex</a></p>
<blockquote>
<p>The CLI sends configuration and code to the cluster every time you run <code>cortex deploy</code>. Each model is loaded into a Docker container, along with any Python packages and request handling code. The model is exposed as a web service using Elastic Load Balancing (ELB), TensorFlow Serving, and ONNX Runtime. The containers are orchestrated on Elastic Kubernetes Service (EKS) while logs and metrics are streamed to CloudWatch.</p>
</blockquote>
<p>CLIå·¥å…·å°†é…ç½®æ–‡ä»¶å’Œä»£ç æ¨é€åˆ°é›†ç¾¤ã€‚æ¨¡å‹è¿åŒPythonä¾èµ–åŒ…å’Œè¯·æ±‚å¤„ç†çš„ä»£ç è¢«Dockerå®¹å™¨æ‰“åŒ…ã€‚ä½¿ç”¨AWS ELBç­‰æš´éœ²å‡ºWebæœåŠ¡ã€‚å®¹å™¨ä½¿ç”¨AWS EKSç¼–æ’ï¼Œæ—¥å¿—å’ŒæŒ‡æ ‡ä¼šæ¨é€åˆ°AWS CloudWatchã€‚</p>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>Multi framework:</strong> Cortex supports TensorFlow, PyTorch, scikit-learn, XGBoost, and more. æ”¯æŒä¸»æµçš„æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ æ¡†æ¶</li>
<li><strong>Autoscaling:</strong> Cortex automatically scales APIs to handle production workloads.</li>
<li><strong>CPU / GPU support:</strong> Cortex can run inference on CPU or GPU infrastructure. CPU/GPUéƒ½æ”¯æŒã€‚</li>
<li><strong>Spot instances:</strong> Cortex supports EC2 spot instances.</li>
<li><strong>Rolling updates:</strong> Cortex updates deployed APIs without any downtime. ä¾èµ–k8sçš„èƒ½åŠ›ã€‚</li>
<li><strong>Log streaming:</strong> Cortex streams logs from deployed models to your CLI. ä¾èµ–CloudWatchçš„èƒ½åŠ›ã€‚</li>
<li><strong>Prediction monitoring:</strong> Cortex monitors network metrics and tracks predictions.</li>
<li><strong>Minimal configuration:</strong> Cortex deployments are defined in a single <code>cortex.yaml</code> file.</li>
</ul>
<h3 id="æˆ‘çš„ä½“éªŒ">æˆ‘çš„ä½“éªŒ</h3>
<ol>
<li>ä¸AWSæ·±åº¦ç»‘å®šã€‚å¯¹ç§æœ‰äº‘ã€å›½å†…å…¬æœ‰äº‘ä¸å¤Ÿå‹å¥½äº†ã€‚</li>
<li>ä¾èµ–KubernetesæœåŠ¡ã€‚</li>
<li>ä¾èµ–äº‘å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚S3ã€OSSã€‚cortex deployçš„å»ºè®®ï¼šcortex will zip files and upload them to the cluster; we recommend that you upload large files/directories (e.g. models) to s3 and download them in your api&rsquo;s <strong>init</strong> function,</li>
<li>æœ‰ä¸€å¥—Python APIæœåŠ¡çš„æ¨¡æ¿ï¼Œå¹¶ä½¿ç”¨Dockerå°è£…ã€‚æ¯”å¦‚ <a href="https://github.com/cortexlabs/cortex/blob/master/images/python-serve/Dockerfile">https://github.com/cortexlabs/cortex/blob/master/images/python-serve/Dockerfile</a></li>
<li>æ¨ç†Predictorç±»æŒ‰ç…§Cortexå®šä¹‰çš„æ¥å£è§„èŒƒå®ç°ï¼Œæ‰€åœ¨ç›®å½•æŒ‚è½½åˆ° /mnt/project ç›®å½•ã€‚</li>
<li>å¯åŠ¨å®¹å™¨ï¼Œé¢„ç½®è„šæœ¬ä¼šå®‰è£…<code>requirement.txt</code>ï¼Œå¹¶åŠ¨æ€åŠ è½½Predictorç±»ã€‚</li>
<li>ä½¿ç”¨è€…åªéœ€è¦å¤„ç†æ¨¡å‹è®­ç»ƒå’ŒæŒ‰ç…§è§„èŒƒå®šä¹‰Predictorç±»ã€‚é‡å¤çš„APIå®šä¹‰ã€éƒ¨ç½²ã€æ‰©å®¹ï¼Œéƒ½å·²ç»è¢«éšè—æ‰äº†ã€‚</li>
</ol>
<h2 id="ä»£ç ç»“æ„">ä»£ç ç»“æ„</h2>
<ol>
<li>cli ç›®å½•ï¼šå®¢æˆ·ç«¯ã€‚deployæ“ä½œï¼Œå°±æ˜¯æŠŠæœ¬åœ°çš„é…ç½®æ–‡ä»¶å‹ç¼©æˆzipåŒ…ä¸Šä¼ ã€‚</li>
<li>pkg/operator ç›®å½•ï¼šæœåŠ¡ç«¯ã€‚deployæ¥å£åœ¨æ­¤ï¼šzipåŒ…ä¼šä¸Šä¼ åˆ°S3ï¼Œç¼–ç¨‹çš„æ–¹å¼ç”³è¯·k8sèµ„æºï¼ˆdeployment, service, virtualServiceï¼‰ï¼Œç›´æ¥å‘k8s API serverå‘é€è¯·æ±‚ã€‚</li>
<li>pkg/lib ç›®å½•ï¼šæ¯”è¾ƒæ ¸å¿ƒçš„Goä»£ç ã€‚</li>
<li>pkg/workloads/cortex/downloader ç›®å½•ï¼šåœ¨k8sä¸­ä½œä¸ºInitContainerï¼Œç”¨äºä¸‹è½½é…ç½®æ–‡ä»¶åˆ°Podä¸­ã€‚</li>
<li>pkg/workloads ç›®å½•ï¼šæ¨ç†æœåŠ¡çš„ä»£ç ï¼Œæ¯”è¾ƒé€šç”¨ã€‚pkg/workloads/cortex/serve/run.sh ç•™äº†ä¸ªå£å­ <code>/mnt/project</code>ï¼Œæ¯ä¸ªæœåŠ¡ä¸ªæ€§åŒ–çš„éƒ¨åˆ†ç•™ç»™å¼€å‘è€…ï¼ˆéµä»è§„èŒƒï¼‰ã€‚</li>
<li>images ç›®å½•ï¼šé•œåƒæ–‡ä»¶ã€‚åŒ…æ‹¬ operator çš„é•œåƒæ–‡ä»¶ï¼Œä¹ŸåŒ…æ‹¬æ¨ç†æœåŠ¡çš„ã€‚</li>
</ol>
<p>å…·ä½“çœ‹çœ‹åˆ›å»ºæ¨ç†æœåŠ¡å®¹å™¨çš„è¿‡ç¨‹ã€‚</p>
<p>ç”³è¯· K8s Deploymentã€‚</p>
<p><img src="../../images/image-20200416151230669.png" alt="image-20200416151230669"></p>
<p>è¿™é‡Œåˆ†ä¸ºä¸‰å¤§ç±»ã€‚</p>
<p><img src="../../images/image-20200416151318515.png" alt="image-20200416151318515"></p>
<p>å…³æ³¨PythonPredictorTypeã€‚</p>
<p><img src="../../images/image-20200416151537448.png" alt="image-20200416151537448"></p>
<p>ä¼ å…¥ InitContainer ï¼ˆä»£ç è§ pkg/workloads/cortex/downloaderï¼‰çš„å‚æ•°å¦‚ä¸‹ï¼Œå°†S3ä¸Šå­˜å‚¨çš„é…ç½®ä¿¡æ¯å’Œpredictoræ–‡ä»¶ç­‰ä¸‹è½½åˆ°Podä¸­çš„ <code>/mnt/project</code>ç›®å½•ï¼ˆ<code>_emptyDirMountPath = &quot;/mnt&quot;</code>ï¼‰ã€‚</p>
<p><img src="../../images/image-20200416152324873.png" alt="image-20200416152324873"></p>
<p>å› ä¸ºPodå†…å®¹å™¨å…±äº«å­˜å‚¨ç©ºé—´ï¼Œè¿™æ ·æ¨ç†æœåŠ¡å®¹å™¨å°±èƒ½è¯»å–åˆ° <code>/mnt/project</code>äº†ã€‚</p>
<h2 id="cortex-é•œåƒä½“éªŒ">cortex é•œåƒä½“éªŒ</h2>
<p>ä¸‹è½½åœ°å€ <a href="https://hub.docker.com/r/cortexlabs/python-serve/tags">https://hub.docker.com/r/cortexlabs/python-serve/tags</a></p>
<p>å®¹å™¨å†…ä»£ç ä¹Ÿæ˜¯ä¾èµ–S3çš„ï¼Œä¸ä¿®æ”¹è¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨ğŸ¤£ã€‚</p>
<p><img src="../../images/image-20200416161622829.png" alt="image-20200416161622829"></p>
<p>åˆ°æ­¤ä¸ºæ­¢å§ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -e CORTEX_SERVING_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">5000</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_WORKERS_PER_REPLICA<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_MAX_WORKER_CONCURRENCY<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_THREADS_PER_WORKER<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_SO_MAX_CONN<span style="color:#f92672">=</span><span style="color:#ae81ff">2048</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_CACHE_DIR<span style="color:#f92672">=</span>/mnt/spec <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -e CORTEX_VERSION<span style="color:#f92672">=</span>0.15.1 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -v <span style="color:#e6db74">`</span>pwd<span style="color:#e6db74">`</span>:/mnt/project <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -v <span style="color:#e6db74">`</span>pwd<span style="color:#e6db74">`</span>:/mnt/spec <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -p 5000:5000 cortexlabs/python-serve:0.15.1
</code></pre></div>
                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">Last modified on 2020-04-16</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://xujiahua.github.io/posts/20200417-etcd_client/">
                    Next<br>etcd api client è¯·æ±‚é‡è¯•é€»è¾‘
                </a>
                
                
                
                <a class="older-posts" href="https://xujiahua.github.io/posts/20200414-k8s-logging/">
                    Previous<br>k8s åº”ç”¨æ—¥å¿—æ”¶é›†
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                






            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2020 è®¸å˜‰åçš„ç¬”è®°
	</div>
    	</div>
    <script src="https://xujiahua.github.io//js/journal.js"></script>
    </body>
</html>
